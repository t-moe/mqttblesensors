<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>MQTT C Client Libraries Internals: Heap.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pahologo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MQTT C Client Libraries Internals
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Heap.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>functions to manage the heap with the goal of eliminating memory leaks  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;Tree.h&quot;</code><br />
<code>#include &quot;Log.h&quot;</code><br />
<code>#include &quot;StackTrace.h&quot;</code><br />
<code>#include &quot;Thread.h&quot;</code><br />
<code>#include &lt;memory.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &quot;Heap.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Heap.c:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c__incl.png" border="0" usemap="#Heap_8c" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structstorageElement.html">storageElement</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Each item on the heap is recorded with this structure.  <a href="structstorageElement.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab428390b014191f134e6e14f8e1c0a34"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab428390b014191f134e6e14f8e1c0a34"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>Broker_recordFFDC</b> (char *symptoms)</td></tr>
<tr class="separator:ab428390b014191f134e6e14f8e1c0a34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad396cf123676793fef45a140578685ac"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#ad396cf123676793fef45a140578685ac">Heap_roundup</a> (size_t size)</td></tr>
<tr class="memdesc:ad396cf123676793fef45a140578685ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Round allocation size up to a multiple of the size of an int.  <a href="#ad396cf123676793fef45a140578685ac">More...</a><br /></td></tr>
<tr class="separator:ad396cf123676793fef45a140578685ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a608dedff6e86c7757dde566dc5664ae2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a608dedff6e86c7757dde566dc5664ae2">ptrCompare</a> (void *a, void *b, int value)</td></tr>
<tr class="memdesc:a608dedff6e86c7757dde566dc5664ae2"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structList.html" title="Structure to hold all data for one list. ">List</a> callback function for comparing storage elements.  <a href="#a608dedff6e86c7757dde566dc5664ae2">More...</a><br /></td></tr>
<tr class="separator:a608dedff6e86c7757dde566dc5664ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ccb4c050d263e120835c8490777f4eb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0ccb4c050d263e120835c8490777f4eb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Heap_check</b> (char *string, void *ptr)</td></tr>
<tr class="separator:a0ccb4c050d263e120835c8490777f4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59e53a989d69c3da767487596d9bfa1f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a59e53a989d69c3da767487596d9bfa1f">mymalloc</a> (char *file, int line, size_t size)</td></tr>
<tr class="memdesc:a59e53a989d69c3da767487596d9bfa1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a block of memory.  <a href="#a59e53a989d69c3da767487596d9bfa1f">More...</a><br /></td></tr>
<tr class="separator:a59e53a989d69c3da767487596d9bfa1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bd4b170edf31e5a101b60a6ddf3fadb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6bd4b170edf31e5a101b60a6ddf3fadb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>checkEyecatchers</b> (char *file, int line, void *p, size_t size)</td></tr>
<tr class="separator:a6bd4b170edf31e5a101b60a6ddf3fadb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18db405bf62aa7e36e4f8756729a5d8c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a18db405bf62aa7e36e4f8756729a5d8c">Internal_heap_unlink</a> (char *file, int line, void *p)</td></tr>
<tr class="memdesc:a18db405bf62aa7e36e4f8756729a5d8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an item from the recorded heap without actually freeing it.  <a href="#a18db405bf62aa7e36e4f8756729a5d8c">More...</a><br /></td></tr>
<tr class="separator:a18db405bf62aa7e36e4f8756729a5d8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25214c297c998eba3cfc8282b1162c69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a25214c297c998eba3cfc8282b1162c69">myfree</a> (char *file, int line, void *p)</td></tr>
<tr class="memdesc:a25214c297c998eba3cfc8282b1162c69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees a block of memory.  <a href="#a25214c297c998eba3cfc8282b1162c69">More...</a><br /></td></tr>
<tr class="separator:a25214c297c998eba3cfc8282b1162c69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f453bffe39551109e282c904a6f2902"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a5f453bffe39551109e282c904a6f2902">Heap_unlink</a> (char *file, int line, void *p)</td></tr>
<tr class="memdesc:a5f453bffe39551109e282c904a6f2902"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an item from the recorded heap without actually freeing it.  <a href="#a5f453bffe39551109e282c904a6f2902">More...</a><br /></td></tr>
<tr class="separator:a5f453bffe39551109e282c904a6f2902"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a699e6722cc8f195f853f09ac274413a3"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a699e6722cc8f195f853f09ac274413a3">myrealloc</a> (char *file, int line, void *p, size_t size)</td></tr>
<tr class="memdesc:a699e6722cc8f195f853f09ac274413a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reallocates a block of memory.  <a href="#a699e6722cc8f195f853f09ac274413a3">More...</a><br /></td></tr>
<tr class="separator:a699e6722cc8f195f853f09ac274413a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f10ff94faca02a6f81953c889802954"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a0f10ff94faca02a6f81953c889802954">Heap_findItem</a> (void *p)</td></tr>
<tr class="memdesc:a0f10ff94faca02a6f81953c889802954"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to find an item in the heap.  <a href="#a0f10ff94faca02a6f81953c889802954">More...</a><br /></td></tr>
<tr class="separator:a0f10ff94faca02a6f81953c889802954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d817a66394c237be9cef05d522453a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a08d817a66394c237be9cef05d522453a">HeapScan</a> (int log_level)</td></tr>
<tr class="memdesc:a08d817a66394c237be9cef05d522453a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scans the heap and reports any items currently allocated.  <a href="#a08d817a66394c237be9cef05d522453a">More...</a><br /></td></tr>
<tr class="separator:a08d817a66394c237be9cef05d522453a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaee40ee4f12cd0344ee98051b43ac90a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaee40ee4f12cd0344ee98051b43ac90a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#aaee40ee4f12cd0344ee98051b43ac90a">Heap_initialize</a> ()</td></tr>
<tr class="memdesc:aaee40ee4f12cd0344ee98051b43ac90a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Heap initialization. <br /></td></tr>
<tr class="separator:aaee40ee4f12cd0344ee98051b43ac90a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0883a5b8881bbb7e84a5d83214c7e3fa"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0883a5b8881bbb7e84a5d83214c7e3fa"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a0883a5b8881bbb7e84a5d83214c7e3fa">Heap_terminate</a> ()</td></tr>
<tr class="memdesc:a0883a5b8881bbb7e84a5d83214c7e3fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Heap termination. <br /></td></tr>
<tr class="separator:a0883a5b8881bbb7e84a5d83214c7e3fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6a9e140d7583a3e76fcfa254c0b3e54"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structheap__info.html">heap_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#aa6a9e140d7583a3e76fcfa254c0b3e54">Heap_get_info</a> ()</td></tr>
<tr class="memdesc:aa6a9e140d7583a3e76fcfa254c0b3e54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access to heap state.  <a href="#aa6a9e140d7583a3e76fcfa254c0b3e54">More...</a><br /></td></tr>
<tr class="separator:aa6a9e140d7583a3e76fcfa254c0b3e54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cdadd76da21b7269cf5d9fc92dedb68"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a6cdadd76da21b7269cf5d9fc92dedb68">HeapDumpString</a> (FILE *file, char *str)</td></tr>
<tr class="memdesc:a6cdadd76da21b7269cf5d9fc92dedb68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump a string from the heap so that it can be displayed conveniently.  <a href="#a6cdadd76da21b7269cf5d9fc92dedb68">More...</a><br /></td></tr>
<tr class="separator:a6cdadd76da21b7269cf5d9fc92dedb68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea7ea58998f69f14e16a3237c1d02d8a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#aea7ea58998f69f14e16a3237c1d02d8a">HeapDump</a> (FILE *file)</td></tr>
<tr class="memdesc:aea7ea58998f69f14e16a3237c1d02d8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump the state of the heap.  <a href="#aea7ea58998f69f14e16a3237c1d02d8a">More...</a><br /></td></tr>
<tr class="separator:aea7ea58998f69f14e16a3237c1d02d8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a6533888772aaa3afdee6a16a1f197087"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6533888772aaa3afdee6a16a1f197087"></a>
static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><b>heap_mutex_store</b> = PTHREAD_MUTEX_INITIALIZER</td></tr>
<tr class="separator:a6533888772aaa3afdee6a16a1f197087"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af369074ecc039810e2beb121821f09a1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af369074ecc039810e2beb121821f09a1"></a>
static mutex_type&#160;</td><td class="memItemRight" valign="bottom"><b>heap_mutex</b> = &amp;heap_mutex_store</td></tr>
<tr class="separator:af369074ecc039810e2beb121821f09a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20b83c8e52be131ca41d22b8bf2c3b38"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a20b83c8e52be131ca41d22b8bf2c3b38"></a>
static <a class="el" href="structheap__info.html">heap_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#a20b83c8e52be131ca41d22b8bf2c3b38">state</a> = {0, 0}</td></tr>
<tr class="memdesc:a20b83c8e52be131ca41d22b8bf2c3b38"><td class="mdescLeft">&#160;</td><td class="mdescRight">global heap state information <br /></td></tr>
<tr class="separator:a20b83c8e52be131ca41d22b8bf2c3b38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f35816bbc12d86f68fd9ea331d40427"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3f35816bbc12d86f68fd9ea331d40427"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><b>eyecatcher</b> = 0x88888888</td></tr>
<tr class="separator:a3f35816bbc12d86f68fd9ea331d40427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa337931db6f2e3b78d5dce6a8d228257"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa337931db6f2e3b78d5dce6a8d228257"></a>
static <a class="el" href="structTree.html">Tree</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Heap_8c.html#aa337931db6f2e3b78d5dce6a8d228257">heap</a></td></tr>
<tr class="memdesc:aa337931db6f2e3b78d5dce6a8d228257"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structTree.html" title="Structure to hold all data for one tree. ">Tree</a> that holds the allocation records. <br /></td></tr>
<tr class="separator:aa337931db6f2e3b78d5dce6a8d228257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39aebac8fca50ea12a14719c9a36a645"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a39aebac8fca50ea12a14719c9a36a645"></a>
static char *&#160;</td><td class="memItemRight" valign="bottom"><b>errmsg</b> = &quot;Memory allocation error&quot;</td></tr>
<tr class="separator:a39aebac8fca50ea12a14719c9a36a645"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>functions to manage the heap with the goal of eliminating memory leaks </p>
<p>For any module to use these functions transparently, simply include the Heap.h header file. Malloc and free will be redefined, but will behave in exactly the same way as normal, so no recoding is necessary. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0f10ff94faca02a6f81953c889802954"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* Heap_findItem </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Utility to find an item in the heap. </p>
<p>Lets you know if the heap already contains the memory location in question. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>pointer to a memory location </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the storage element if found, or NULL </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a0f10ff94faca02a6f81953c889802954_cgraph.png" border="0" usemap="#Heap_8c_a0f10ff94faca02a6f81953c889802954_cgraph" alt=""/></div>
<map name="Heap_8c_a0f10ff94faca02a6f81953c889802954_cgraph" id="Heap_8c_a0f10ff94faca02a6f81953c889802954_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="176,5,323,32"/><area shape="rect" id="node3" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="168,56,331,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa6a9e140d7583a3e76fcfa254c0b3e54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structheap__info.html">heap_info</a>* Heap_get_info </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Access to heap state. </p>
<dl class="section return"><dt>Returns</dt><dd>pointer to the heap state structure </dd></dl>

</div>
</div>
<a class="anchor" id="ad396cf123676793fef45a140578685ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t Heap_roundup </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Round allocation size up to a multiple of the size of an int. </p>
<p>Apart from possibly reducing fragmentation, on the old v3 gcc compilers I was hitting some weird behaviour, which might have been errors in sizeof() used on structures and related to packing. In any case, this fixes that too. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>the size actually needed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the rounded up size </dd></dl>

</div>
</div>
<a class="anchor" id="a5f453bffe39551109e282c904a6f2902"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Heap_unlink </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove an item from the recorded heap without actually freeing it. </p>
<p>Use sparingly! </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>use the <b>FILE</b> macro to indicate which file this item was allocated in </td></tr>
    <tr><td class="paramname">line</td><td>use the <b>LINE</b> macro to indicate which line this item was allocated at </td></tr>
    <tr><td class="paramname">p</td><td>pointer to the item to be removed </td></tr>
  </table>
  </dd>
</dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a5f453bffe39551109e282c904a6f2902_cgraph.png" border="0" usemap="#Heap_8c_a5f453bffe39551109e282c904a6f2902_cgraph" alt=""/></div>
<map name="Heap_8c_a5f453bffe39551109e282c904a6f2902_cgraph" id="Heap_8c_a5f453bffe39551109e282c904a6f2902_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="692,47,839,74"/><area shape="rect" id="node3" href="Heap_8c.html#a18db405bf62aa7e36e4f8756729a5d8c" title="Remove an item from the recorded heap without actually freeing it. " alt="" coords="153,47,307,74"/><area shape="rect" id="node6" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="684,98,847,124"/><area shape="rect" id="node4" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="580,98,625,124"/><area shape="rect" id="node7" href="Tree_8c.html#a9c3b81e7e63498e3a8f7bd28c4caec10" title="Remove an item from a tree. " alt="" coords="355,47,521,74"/><area shape="rect" id="node5" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="708,148,823,175"/><area shape="rect" id="node8" href="Heap_8c.html#a25214c297c998eba3cfc8282b1162c69" title="Frees a block of memory. " alt="" coords="569,47,636,74"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aea7ea58998f69f14e16a3237c1d02d8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HeapDump </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dump the state of the heap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>file handle to dump the heap contents to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a6cdadd76da21b7269cf5d9fc92dedb68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HeapDumpString </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dump a string from the heap so that it can be displayed conveniently. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>file handle to dump the heap contents to </td></tr>
    <tr><td class="paramname">str</td><td>the string to dump, could be NULL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a08d817a66394c237be9cef05d522453a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HeapScan </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>log_level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scans the heap and reports any items currently allocated. </p>
<p>To be used at shutdown if any heap items have not been freed. </p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a08d817a66394c237be9cef05d522453a_cgraph.png" border="0" usemap="#Heap_8c_a08d817a66394c237be9cef05d522453a_cgraph" alt=""/></div>
<map name="Heap_8c_a08d817a66394c237be9cef05d522453a_cgraph" id="Heap_8c_a08d817a66394c237be9cef05d522453a_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="243,5,389,32"/><area shape="rect" id="node3" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="141,56,187,83"/><area shape="rect" id="node5" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="235,107,397,133"/><area shape="rect" id="node4" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="259,56,373,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a18db405bf62aa7e36e4f8756729a5d8c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Internal_heap_unlink </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove an item from the recorded heap without actually freeing it. </p>
<p>Use sparingly! </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>use the <b>FILE</b> macro to indicate which file this item was allocated in </td></tr>
    <tr><td class="paramname">line</td><td>use the <b>LINE</b> macro to indicate which line this item was allocated at </td></tr>
    <tr><td class="paramname">p</td><td>pointer to the item to be removed </td></tr>
  </table>
  </dd>
</dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a18db405bf62aa7e36e4f8756729a5d8c_cgraph.png" border="0" usemap="#Heap_8c_a18db405bf62aa7e36e4f8756729a5d8c_cgraph" alt=""/></div>
<map name="Heap_8c_a18db405bf62aa7e36e4f8756729a5d8c_cgraph" id="Heap_8c_a18db405bf62aa7e36e4f8756729a5d8c_cgraph">
<area shape="rect" id="node2" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="432,56,477,83"/><area shape="rect" id="node6" href="Tree_8c.html#a9c3b81e7e63498e3a8f7bd28c4caec10" title="Remove an item from a tree. " alt="" coords="207,157,373,184"/><area shape="rect" id="node3" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="544,107,691,133"/><area shape="rect" id="node4" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="560,5,675,32"/><area shape="rect" id="node5" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="536,56,699,83"/><area shape="rect" id="node7" href="Heap_8c.html#a25214c297c998eba3cfc8282b1162c69" title="Frees a block of memory. " alt="" coords="421,107,488,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a25214c297c998eba3cfc8282b1162c69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void myfree </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees a block of memory. </p>
<p>A direct replacement for free, but checks that a item is in the allocates list first. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>use the <b>FILE</b> macro to indicate which file this item was allocated in </td></tr>
    <tr><td class="paramname">line</td><td>use the <b>LINE</b> macro to indicate which line this item was allocated at </td></tr>
    <tr><td class="paramname">p</td><td>pointer to the item to be freed </td></tr>
  </table>
  </dd>
</dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a25214c297c998eba3cfc8282b1162c69_cgraph.png" border="0" usemap="#Heap_8c_a25214c297c998eba3cfc8282b1162c69_cgraph" alt=""/></div>
<map name="Heap_8c_a25214c297c998eba3cfc8282b1162c69_cgraph" id="Heap_8c_a25214c297c998eba3cfc8282b1162c69_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="544,5,691,32"/><area shape="rect" id="node3" href="Heap_8c.html#a18db405bf62aa7e36e4f8756729a5d8c" title="Remove an item from the recorded heap without actually freeing it. " alt="" coords="120,56,273,83"/><area shape="rect" id="node6" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="536,132,699,159"/><area shape="rect" id="node4" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="382,56,427,83"/><area shape="rect" id="node7" href="Tree_8c.html#a9c3b81e7e63498e3a8f7bd28c4caec10" title="Remove an item from a tree. " alt="" coords="321,107,488,133"/><area shape="rect" id="node5" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="560,56,675,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a59e53a989d69c3da767487596d9bfa1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* mymalloc </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a block of memory. </p>
<p>A direct replacement for malloc, but keeps track of items allocated in a list, so that free can check that a item is being freed correctly and that we can check that all memory is freed at shutdown. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>use the <b>FILE</b> macro to indicate which file this item was allocated in </td></tr>
    <tr><td class="paramname">line</td><td>use the <b>LINE</b> macro to indicate which line this item was allocated at </td></tr>
    <tr><td class="paramname">size</td><td>the size of the item to be allocated </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the allocated item, or NULL if there was an error </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a59e53a989d69c3da767487596d9bfa1f_cgraph.png" border="0" usemap="#Heap_8c_a59e53a989d69c3da767487596d9bfa1f_cgraph" alt=""/></div>
<map name="Heap_8c_a59e53a989d69c3da767487596d9bfa1f_cgraph" id="Heap_8c_a59e53a989d69c3da767487596d9bfa1f_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="309,5,456,32"/><area shape="rect" id="node3" href="Heap_8c.html#ad396cf123676793fef45a140578685ac" title="Round allocation size up to a multiple of the size of an int. " alt="" coords="137,31,253,57"/><area shape="rect" id="node4" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="173,81,218,108"/><area shape="rect" id="node6" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="301,132,464,159"/><area shape="rect" id="node5" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="325,81,440,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a699e6722cc8f195f853f09ac274413a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* myrealloc </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reallocates a block of memory. </p>
<p>A direct replacement for realloc, but keeps track of items allocated in a list, so that free can check that a item is being freed correctly and that we can check that all memory is freed at shutdown. We have to remove the item from the tree, as the memory is in order and so it needs to be reinserted in the correct place. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>use the <b>FILE</b> macro to indicate which file this item was reallocated in </td></tr>
    <tr><td class="paramname">line</td><td>use the <b>LINE</b> macro to indicate which line this item was reallocated at </td></tr>
    <tr><td class="paramname">p</td><td>pointer to the item to be reallocated </td></tr>
    <tr><td class="paramname">size</td><td>the new size of the item </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the allocated item, or NULL if there was an error </dd></dl>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="Heap_8c_a699e6722cc8f195f853f09ac274413a3_cgraph.png" border="0" usemap="#Heap_8c_a699e6722cc8f195f853f09ac274413a3_cgraph" alt=""/></div>
<map name="Heap_8c_a699e6722cc8f195f853f09ac274413a3_cgraph" id="Heap_8c_a699e6722cc8f195f853f09ac274413a3_cgraph">
<area shape="rect" id="node2" href="Thread_8c.html#a7e92185eb22775c76e1b6b8865468f17" title="Lock a mutex which has already been created, block until ready. " alt="" coords="309,5,456,32"/><area shape="rect" id="node3" href="Log_8c.html#a87f2e36f80963ac280f67b9ccdf03d0a" title="Log a message. " alt="" coords="173,56,218,83"/><area shape="rect" id="node5" href="Thread_8c.html#a5faf758226199e7cf93f6b489aca07f7" title="Unlock a mutex which has already been locked. " alt="" coords="301,107,464,133"/><area shape="rect" id="node6" href="Heap_8c.html#ad396cf123676793fef45a140578685ac" title="Round allocation size up to a multiple of the size of an int. " alt="" coords="137,157,253,184"/><area shape="rect" id="node4" href="Messages_8c.html#a29732d9f9c438e569ddc89a5ee61501c" title="Get a log message by its index. " alt="" coords="325,56,440,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a608dedff6e86c7757dde566dc5664ae2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ptrCompare </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="structList.html" title="Structure to hold all data for one list. ">List</a> callback function for comparing storage elements. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>pointer to the current content in the tree (storageElement*) </td></tr>
    <tr><td class="paramname">b</td><td>pointer to the memory to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>boolean indicating whether a and b are equal </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 4 2016 12:02:58 for MQTT C Client Libraries Internals by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
