<!DOCTYPE html>
<html>
<head>
  <title>BLE Sensor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8" />
  <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="js_test.js"></script>
  <script type="text/javascript" src="mqttws31.js"></script>
</head>
<body>

<header>
	<ul class="w3-navbar">
		<li><a href="javascript:void(0)" onclick="openMenuItem('Configuration')">Configuration</a></li>
		<li><a href="javascript:void(0)" onclick="openMenuItem('Measure')">Measure</a></li>
	</ul>
</header>

<div id="Configuration" class="menuItem">
	<div class="w3-container w3-teal">
		<h2>Configuration</h2>
	</div>
	<div class="w3-panel">
  		<input type="checkbox" id="scanCB" /> Scan
		<p>Gefundene BLE Sensoren:<p>
		
		
		<ul class="w3-ul w3-card-4 w3-margin-top" id="ScanList">
			<li class="w3-padding-16" style="display:none;" >
				<span class="w3-xlarge">Template Device Name</span><br>
				<span>Disconnected</span>
			</li>
		</ul>
	</div>
</div>

<div id="Measure" class="menuItem">
	<div class="w3-container w3-teal">
		<h2>Measure</h2>
	</div>
	<div class="w3-panel">
	<div class="w3-panel w3-light-grey">
		<p>Temperature</p>
		<div id="tempChart" style="width: 700px; height: 350px"></div><br>
	</div>
  	
	<div class="w3-panel w3-light-grey">
		<p>Acceleration</p>
		<div id="accelChart" style="width: 700px; height: 350px"></div><br>
	</div>
  	
	<div class="w3-panel w3-light-grey">
		<p>Gyroscope</p>
		<div id="gyroChart" style="width: 700px; height: 350px"></div><br>
	</div>
</body>


<script>
openMenuItem("Configuration");

$("#ScanList li" ).click(function() {
	$("#ScanList li").not(this).removeClass("w3-orange w3-green");
  
	if( $(this).hasClass("w3-green") || $(this).hasClass("w3-orange")) {
		// this device is connected: disconnect it
		var obj = {
			disconnect: $(this).data("Adress")
		};
		send(obj);
		$(this).removeClass("w3-green w3-orange");
	}
	else {
		// this device is disconnected: connect it
		var obj = {
			connect: $(this).data("Adress")
		};
		send(obj);
		$(this).addClass("w3-orange").find("span:eq(1)").text("Connecting");
	}
});

/* Checkbox returns the selected value (true / false) */

$( "#scanCB" ).change(function() {
	var obj = {
		scan: $(this).prop("checked") //return true or false
	};
	send(obj);
});

/*-----------------------------------------------------------------------------------------------------------------------*/
/* Data Communication */
/*-----------------------------------------------------------------------------------------------------------------------*/

// Parameters
var hostname = '147.87.98.17';
var port = 9001;

// Create a client instance
var client = new Paho.MQTT.Client(hostname, port, '/mqtt', "clientId"+Math.random());

// Set callback handlers
client.onConnectionLost = onConnectionLost;
client.onMessageArrived = onMessageArrived;

// Connect the client
client.connect({
    userName: "gruppe_11",
    password: "P8G42XEe",
    onSuccess: onConnect,
    onFailure: onConnectionFailure
});

/* Google Chart */
google.charts.load('current', {packages: ['line']});
</script>
</html>